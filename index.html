<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Big Five Test</title>
  <style>
    :root{--bg:#0b0d10;--panel:#12161b;--text:#e7edf3;--muted:#9aa4af;
      --accent:#4fb477;--border:#1e242b;--radius:16px;}
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font:16px/1.5 system-ui,sans-serif;}
    .wrap{max-width:920px;margin:32px auto 64px;padding:0 16px;}
    h1,h2{margin:0 0 14px}
    .card{background:var(--panel);border:1px solid var(--border);border-radius:var(--radius);
      padding:24px;box-shadow:0 8px 30px rgba(0,0,0,.25);}
    .muted{color:var(--muted)}
    .step{display:none}.step.active{display:block}
    .footer{display:flex;gap:12px;justify-content:space-between;align-items:center;margin-top:20px;flex-wrap:wrap;}
    .btn{padding:12px 18px;border:none;border-radius:12px;background:var(--accent);color:#08110b;
      font-weight:700;cursor:pointer;transition:filter .2s,transform .06s;}
    .btn.secondary{background:#1a1e23;color:var(--text);border:1px solid var(--border)}
    .btn:hover{filter:brightness(1.05)} .btn:active{transform:translateY(1px)}
    .btn:disabled{opacity:.5;cursor:not-allowed;filter:grayscale(.2)}
    .fields{display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-top:8px}
    @media (max-width:760px){.fields{grid-template-columns:1fr}}
    label{display:block;font-weight:600;margin:0 0 6px}
    input[type="text"],input[type="email"]{width:100%;padding:12px 14px;border-radius:12px;border:1px solid var(--border);
      background:#0e1216;color:var(--text);outline:none;}
    input:focus{box-shadow:0 0 0 3px rgba(79,180,119,.35);border-color:var(--accent)}
    .progress{margin:6px 0 12px;color:var(--muted)}
    .question{margin:18px 0;padding:14px;border:1px solid var(--border);border-radius:12px;background:#0f1216;}
    .q-title{font-weight:600;margin-bottom:10px}
    .stars{display:flex;flex-direction:row-reverse;justify-content:center;gap:10px;user-select:none;}
    .stars input{display:none}
    .stars label{font-size:42px;line-height:1;cursor:pointer;color:#2a313a;
      transition:transform .08s ease,color .15s ease,text-shadow .15s ease;text-shadow:0 0 0 rgba(0,0,0,0);}
    .stars input:checked ~ label,
    .stars label:hover,
    .stars label:hover ~ label{color:var(--accent);text-shadow:0 0 8px rgba(79,180,119,.25);transform:translateY(-1px);}
    .note{font-size:13px;color:var(--muted)}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Big Five Test</h1>

    <form id="form" method="POST"
      action="https://xuxudenucka.app.n8n.cloud/webhook/c7c06a6f-c1dc-4a06-9edb-03d7bd2e6ed8">

      <!-- Шаг 0 -->
      <section id="step0" class="step active">
        <div class="card">
          <h2>Перед началом</h2>
          <p class="muted">Укажите свои данные — они отправятся вместе с ответами на вебхук n8n.</p>
          <div class="fields">
            <div>
              <label for="full_name">ФИО</label>
              <input id="full_name" name="full_name" type="text" autocomplete="name" required>
            </div>
            <div>
              <label for="email">Email</label>
              <input id="email" name="email" type="email" autocomplete="email" required>
            </div>
          </div>
          <div class="footer">
            <span class="note">Переход далее станет доступен после заполнения полей.</span>
            <button type="button" class="btn" id="next0" disabled>Перейти к вопросам</button>
          </div>
        </div>
      </section>

      <div id="questionSteps"></div>

      <section id="finalStep" class="step">
        <div class="card">
          <h2>Готово!</h2>
          <p>Вы ответили на все 61 вопрос. Нажмите «Отправить», чтобы передать ответы.</p>
          <div class="footer">
            <button type="button" class="btn secondary prev">Назад</button>
            <button type="submit" class="btn">Отправить</button>
          </div>
        </div>
      </section>
    </form>
  </div>
<input type="hidden" name="chatid" id="chatid">
<script>
document.addEventListener('DOMContentLoaded', () => {
  const urlParams = new URLSearchParams(window.location.search);
  const chatId = urlParams.get("chatid");
  if (chatId) {
    document.getElementById("chatid").value = chatId;
  }
});
</script>
  <script>
    const QUESTIONS = [
      "общительный, открытый","сопереживающий и добросердечный","склонный быть неорганизованным",
      "расслабленный, хорошо справляющийся со стрессом","мало интересующийся искусством","напористый",
      "относящийся к другим людям с уважением","предпочитающий отдыхать, а не работать",
      "в случае неудачи не теряющий оптимизма","интеллектуальный","часто чувствующий себя уставшим",
      "склонный искать ошибки в поступках других людей","заслуживающий доверия, постоянный",
      "настроения – с эмоциональными «взлетами» и «падениями»","изобретательный, находящий нестандартные решения",
      "склонный быть молчаливым","мало сочувствующий другим людям","собранный, любящий во всем порядок",
      "нервничающий по любому поводу","увлеченный живописью, музыкой или литературой",
      "доминирующий, ведущий себя по-лидерски","бестактный в общении","с трудом приступающий к работе",
      "гармоничный и довольный жизнью","избегающий интеллектуальных и философских разговоров","пассивный, вялый",
      "в целом доверяющий другим людям","нарушающий обязательства","эмоционально стабильный, которого нелегко вывести из себя",
      "мыслящий шаблонно, стереотипно","порой застенчивый, погруженный в себя","отзывчивый и бескорыстный",
      "прилежный и аккуратный","часто волнующийся, обо всем переживающий","ценящий искусство и красоту",
      "считающий, что ему трудно влиять на людей","порой бывающий грубым с окружающими","продуктивный, выполняющий задуманное",
      "часто грустящий","сложный, глубоко мыслящий","полный энергии","подозрительный к намерениям других людей",
      "надежный, на меня всегда можно рассчитывать","держащий эмоции под контролем","неизобретательный","разговорчивый",
      "помогающий, только если мне это выгодно","оставляющий за собой беспорядок, не любящий убираться",
      "редко тревожащийся или боящийся","считающий, что театр и поэзия – это скучно",
      "предпочитающий, чтобы решения принимали другие","вежливый, учтивый в общении с другими",
      "настойчивый, доводящий дело до конца","склонный к печали, депрессии","мало интересующийся абстрактными идеями",
      "излучающий энтузиазм, заражающий им окружающих","склонный видеть в других людях только хорошее",
      "часто ведущий себя безответственно","эмоциональный, неуравновешенный",
      "генерирующий новые идеи, оригинально мыслящий","бывающий легкомысленным"
    ];

    function blockIndex(i){ return Math.min(Math.floor(i/10)+1, 6); }

    const stepsContainer = document.getElementById('questionSteps');

    for (let b = 1; b <= 6; b++){
      const start = b <= 5 ? (b-1)*10 + 1 : 51;
      const end   = b <= 5 ? b*10       : 61;
      const sec = document.createElement('section');
      sec.className = 'step';
      sec.id = 'step'+b;
      sec.innerHTML = `
        <div class="card">
          <h2>Вопросы ${start}–${end}</h2>
          <p class="muted">Я человек...</p>
          <div class="progress">Страница ${b} из 6</div>
          <div class="qwrap"></div>
          <div class="footer">
            <button type="button" class="btn secondary prev">Назад</button>
            <button type="button" class="btn next" disabled>Далее</button>
          </div>
        </div>`;
      stepsContainer.appendChild(sec);
    }

    QUESTIONS.forEach((text, i) => {
      const b = blockIndex(i);
      const wrap = document.querySelector('#step'+b+' .qwrap');
      const qNum = i + 1;
      const box = document.createElement('div');
      box.className = 'question';
      const stars = [5,4,3,2,1].map(v => `
        <input type="radio" id="q${qNum}_${v}" name="q${qNum}" value="${v}" required>
        <label for="q${qNum}_${v}" title="${v} из 5">★</label>
      `).join('');
      box.innerHTML = `
        <div class="q-title">${qNum}. ${text}</div>
        <div class="stars">${stars}</div>`;
      wrap.appendChild(box);
    });

    const steps = Array.from(document.querySelectorAll('.step'));
    let current = 0;
    function showStep(idx){
      steps[current].classList.remove('active');
      steps[idx].classList.add('active');
      current = idx;
      window.scrollTo({top:0,behavior:'smooth'});
    }

    document.addEventListener('click', (e) => {
      if (e.target.classList.contains('next')) {
        if (e.target.disabled) return;
        if (steps[current].id === 'step6') showStep(steps.findIndex(s => s.id==='finalStep'));
        else showStep(current + 1);
      }
      if (e.target.classList.contains('prev')) {
        if (steps[current].id === 'finalStep') showStep(steps.findIndex(s => s.id==='step6'));
        else showStep(Math.max(0, current - 1));
      }
    });

    const nameInput = document.getElementById('full_name');
    const emailInput = document.getElementById('email');
    const next0 = document.getElementById('next0');
    function updateStep0Validity(){
      const ok = nameInput.value.trim().length > 0 && emailInput.checkValidity();
      next0.disabled = !ok;
    }
    nameInput.addEventListener('input', updateStep0Validity);
    emailInput.addEventListener('input', updateStep0Validity);
    updateStep0Validity();
    next0.addEventListener('click', (e) => {
      e.stopPropagation();          
      if (!next0.disabled) showStep(1); 
    });

    for (let b = 1; b <= 6; b++){
      const step = document.getElementById('step'+b);
      const nextBtn = step.querySelector('.next');
      const qwrap = step.querySelector('.qwrap');
      function updateQuestionsStepValidity(){
        const radios = Array.from(qwrap.querySelectorAll('input[type="radio"]'));
        const names = new Set(radios.map(r => r.name));
        const answered = new Set(Array.from(qwrap.querySelectorAll('input[type="radio"]:checked')).map(r => r.name));
        nextBtn.disabled = answered.size !== names.size;
      }
      step.addEventListener('change', (e) => {
        if (e.target.matches('input[type="radio"]')) updateQuestionsStepValidity();
      });
      updateQuestionsStepValidity();
    }

const form = document.getElementById('form');
form.addEventListener('submit', async (e) => {
  e.preventDefault();
  const fd = new FormData(form);
  const data = Object.fromEntries(fd.entries());

  const showThanks = () => {
    document.body.innerHTML = `
      <div style="display:flex;flex-direction:column;align-items:center;justify-content:center;
        height:100vh;font-family:sans-serif;background:#f7f9fb;color:#222;text-align:center;">
        <div style="background:#fff;padding:40px;border-radius:16px;
          box-shadow:0 4px 14px rgba(0,0,0,0.08);max-width:520px;">
          <h1 style="margin-bottom:16px;color:#4fb477;">Спасибо за прохождение теста!</h1>
          <p style="font-size:18px;line-height:1.5;">Ваши ответы отправлены. Эту вкладку можно закрыть вручную.</p>
        </div>
      </div>`;
  };

  try {
    const resp = await fetch(form.action, {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify(data)
    });
    if (!resp.ok) throw new Error('HTTP '+resp.status);
    showThanks();
  } catch (err) {
    const iframe = document.createElement('iframe');
    iframe.name = 'hidden_sink';
    iframe.style.display = 'none';
    document.body.appendChild(iframe);

    const f = document.createElement('form');
    f.action = form.action;
    f.method = 'POST';
    f.target = 'hidden_sink';
    for (const [k,v] of fd.entries()){
      const input = document.createElement('input');
      input.type = 'hidden';
      input.name = k;
      input.value = v;
      f.appendChild(input);
    }
    document.body.appendChild(f);
    try { f.submit(); } catch(e){}
    showThanks();
  }
});
  </script>

</body>
</html>
